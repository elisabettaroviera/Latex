\documentclass[10pt]{extarticle}

% Lingua e matematica
\usepackage[english]{babel}
\usepackage{amsmath,amssymb,amsthm}

% Grafica e tabelle
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{float}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{siunitx}
\usepackage{wrapfig}
\usepackage{placeins}


% Codice (opzionale)
\usepackage{listings}
\usepackage{xcolor}
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.98,0.98,0.98}
\lstdefinestyle{mystyle}{
  backgroundcolor=\color{backcolour},
  commentstyle=\color{codegreen},
  keywordstyle=\color{magenta},
  numberstyle=\tiny\color{codegray},
  stringstyle=\color{codepurple},
  basicstyle=\ttfamily\footnotesize,
  breaklines=true, keepspaces=true, numbers=none, tabsize=2
}
\lstset{style=mystyle}

% Margini
\usepackage[margin=0.6in]{geometry}
\usepackage{ragged2e}
\usepackage{enumitem}
%\usepackage[utf8]{inputenc} % per caratteri UTF-8 nei .tex e nel .bib
\usepackage[backend=biber,style=ieee,sorting=none,maxbibnames=99]{biblatex}
\ExecuteBibliographyOptions{doi=true,url=true,isbn=false}
\addbibresource{references.bib}
\usepackage{csquotes}       % consigliato da biblatex (evita warning e parse strani)
\usepackage{pifont}
\newcommand{\good}[1]{\textcolor{teal!70!black}{\ding{51}~#1}}



% Bibliografia (biblatex + biber)
\usepackage[backend=biber,style=ieee]{biblatex}
\addbibresource{references.bib}

% TOC: includi anche \paragraph e numerali
\setcounter{secnumdepth}{2}
\setcounter{tocdepth}{2}

% Hyperref (sempre *dopo* gli altri pacchetti)
\usepackage[colorlinks=true,linkcolor=blue,citecolor=teal,urlcolor=magenta]{hyperref}


\begin{document}

% Custom header without a separate titlepage
\noindent
\begin{minipage}{0.3\textwidth}
    \includegraphics[width=1.3\linewidth]{Figures/polito_logo_2021_blu.jpg}
\end{minipage}
\hfill
\begin{minipage}{0.68\textwidth}
    \raggedleft
    {\LARGE \textbf{Politecnico di Torino}}\\[0.2cm]
    {\large Master's Degree in Mathematical Engineering}\\[0.7cm]
    {\large \textbf{Material for Thesis}}\\[0.2cm]
    {\large b-- Data Pre-processing Pipeline in GSE69914 \\ — Illumina 450K}\\[0.7cm]
    \begin{tabular}{rl}
        Elisabetta Roviera & \texttt{s328422} \\
    \end{tabular}
\end{minipage}

\vspace{1cm}
\hrule
\vspace{0.5cm}

\tableofcontents

\vspace{0.5cm}
\hrule
\vspace{1cm}


% Main content begins here, on the same page
\justifying

\begin{abstract}
{\color{red}
\textbf{MANCA L'ABSTRACT, LO SCRIVO DOPO.}\\
\textbf{AGGIUNGI I LINK AI NOTEBOOK - GITHUB SIA PER DATASET CONSTRUCTION AND STORAGE CHE PER IL DATASET PRE PROCESSING.}\\
}
\end{abstract}



\section{Dataset construction and storage}\label{sec:data_storage}

I constructed the working methylation matrix in three stages, prioritizing speed, low memory usage, and reproducible I/O.

\begin{enumerate}
  \item \textbf{Ingestion and transposition.}
  I parsed the GEO Series Matrix for \texttt{GSE69914}, skipping the 73-line metadata header. 
  The source table is organized as \emph{CpG $\times$ sample} with \texttt{ID\_REF} as CpG identifiers; I coerced all sample columns to numeric (invalid entries set to \texttt{NaN}) and then transposed the matrix to the analysis layout \emph{sample $\times$ CpG}. 
  After transposition, I promoted the original column names (GSM accessions / basenames) to a dedicated identifier column named \texttt{id\_tissue} and kept CpG probe columns only (prefix \texttt{cg} or \texttt{ch}).

  \item \textbf{Label derivation and append-only write.}
  I derived the class label directly from GSM metadata by parsing the field \textit{status(0=normal, 1=normal-adjacent, 2=breast cancer, 3=normal-BRCA1, 4=cancer-BRCA1)}, producing a numeric \texttt{label} in $\{0,1,2,3,4\}$. 
  To avoid an in-memory join on a very wide table ($\sim$485k CpGs), I streamed through the transposed file once and appended \texttt{label} row-wise, preserving row order and ensuring constant memory usage.

  \item \textbf{Columnar storage and typed schema.}
  For long-term access, I wrote the labeled table to columnar \texttt{Parquet} with a fixed schema: \texttt{label} as \texttt{Int8} and probe intensities as \texttt{Float32}. 
  I applied a lazy, regex-based column projection (\texttt{cg|ch}) to cast all probe columns in one pass and compressed the file with lossless LZ4. 
  This yields fast full-table reads and efficient column projection (both in Polars and pandas) without repeatedly parsing large CSV text.
\end{enumerate}

This procedure produces a compact, typed matrix that enables rapid downstream preprocessing (technical filtering, normalization) and modeling without incurring large RAM overhead or costly re-ingestion steps.

\section{Import and Data Structure}\label{sec:data_structure}

The processed dataset is imported from the LZ4-compressed \texttt{.parquet} file generated in the previous step.  
The structure is already optimized for analysis.

\begin{itemize}[label=-]
    \item \textbf{File format:} columnar \texttt{Parquet} (LZ4 compression) for fast I/O.
    \item \textbf{Rows:} samples (one per tissue).
    \item \textbf{Columns:} 
    \begin{itemize}[label=--]
        \item \texttt{id\_tissue}: unique sample identifier.
        \item \texttt{label}: numeric class code (\texttt{Int8}).
        \item \texttt{cg}, \texttt{ch}: methylation probes (\texttt{Float32}).
    \end{itemize}
    \item \textbf{Import method:} read via \href{https://pola.rs/}{Polars} (or \href{https://pandas.pydata.org/}{pandas}) with column projection for efficient partial loading.
\end{itemize}

\paragraph{Precision and data representation.}
Because $\beta$-values are strictly bounded within $[0,1]$~\cite{Weinhold2016BetaModel}, and methylation differences of biological interest typically occur at magnitudes between $10^{-2}$ and $10^{-3}$, single-precision floating point (\texttt{float32}, machine~$\epsilon \approx 10^{-7}$) provides more than adequate numerical accuracy while significantly reducing memory usage and I/O time. This representation is further supported by recent large-scale genomics frameworks that process molecular features, including DNA methylation data, entirely in \texttt{float32} precision~\cite{deAlmeida2025ChatNT}.

\vspace{0.2cm}
Moreover, this format ensures minimal memory usage and extremely fast access for all downstream preprocessing and analysis tasks.

\section{Data Validation and Integrity Check}\label{sec:data_validation}

\paragraph{Data Validation.}
I validated the structural integrity of the processed dataset to ensure that its layout, types, and values were correctly preserved after conversion and compression.

\begin{itemize}[label=-]
    \item \textbf{Dimensions:} the dataset contains $(407, 485.514)$ entries, corresponding to \textbf{samples}~$\times$~\textbf{CpG loci}.
    \good{confirmed as expected: 407 samples and 485.514 probes.}
    
    \item \textbf{Data types:} \texttt{id\_tissue} is stored as \texttt{String}, \texttt{label} as \texttt{Int8}, and probe intensities as \texttt{Float32}, 
    ensuring \textbf{compact representation} and sufficient precision for $\beta$-values.
    \good{verified: \texttt{String, Int8, Float32} schema detected.}
    
    \item \textbf{Value range:} all $\beta$-values fall within the valid range $0 \leq \beta \leq 1$, confirming their correct interpretation as methylation proportions.
     \good{The observed range was $[0.000000,\,0.997110]$.}
\end{itemize}


\paragraph{Missing Value Analysis.}
Next, I performed a comprehensive check for missing values ($\text{NaN}$), as these can severely impact model performance and must be addressed before training.

\begin{itemize}[label=-]
    \item No missing entries ($\text{NaN}$) were detected across any CpG probe.
    \good{Total NaN count: 0 |  Overall missing rate: 0\%.}
    
    \item The methylation matrix is therefore \textbf{complete}, requiring \textbf{no filtering or imputation} procedures.
    \good{Dataset confirmed fully complete.}
    
    \item For future datasets:
    \begin{itemize}[label=--]
        \item If the overall missing rate is $< 1\%$, imputation may be considered as an optional step.
        \item If probe missingness exceeds $5\%$ or sample missingness exceeds $10\%$, the affected entities should be discarded, following standard preprocessing practices~\cite{zhou2016}.
    \end{itemize}
\end{itemize}


This validation confirms the dataset is structurally sound, numerically consistent, and complete, enabling unbiased downstream variance modeling, differential methylation testing, and batch correction without any further cleaning

\section{Correction of Infinium I/II Probe Bias}

Raw methylation intensity data (\textit{IDAT} files) from the \textbf{GSE69914} dataset were processed using the \texttt{minfi} package (v1.8.9) and \texttt{BMIQ} normalization (v1.4), as reported in \cite{GSE69914}.
This preprocessing pipeline includes the \textbf{Bias Correction between Infinium Type I and Type II probes}, ensuring that $\beta$-value distributions from both probe designs are comparable prior to downstream analysis.

To verify that the bias correction was successfully applied, the $\beta$-value distributions were stratified by probe design (Type~I vs.~Type~II) using the official Illumina 450K manifest obtained from the \texttt{IlluminaHumanMethylation450kanno.} \texttt{ilmn12.hg19} Bioconductor package~\cite{Illumina450kAnno}.
Following the framework proposed by Teschendorff et al. \cite{Teschendorff2013BMIQ}, two diagnostic plots were generated.
\begin{enumerate}
    \item \textbf{Left panel:} the $\beta$-value density distributions of Type~I and Type~II probes are shown to overlap substantially, indicating no evident design-driven bias in the normalized data;
    \item \textbf{Right panel:} a Q--Q plot of Type~II versus Type~I quantiles demonstrates a median absolute deviation from the identity line of $|\Delta| = 0.162$, confirming good alignment between probe types after BMIQ normalization.
\end{enumerate}

The observed deviation value ($|\Delta| \approx 0.16$) is consistent with well-corrected datasets, as discussed by Teschendorff et al. \cite{Teschendorff2013BMIQ} and by Yousefi et al. \cite{Yousefi2013ProbeBias}, who report that post-BMIQ alignment typically reduces the median deviation below $\sim0.20$, while uncorrected data often exceed $0.25$--$0.30$.
Hence, the present dataset shows \textbf{no residual Infinium I/II bias}, and no further probe-type correction was required.
{\color{red}MANCA L'INTERVALLO GIUSTO (SOTTO I 0.18)}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{Figures/type_bias_density_and_qq.png}
    \caption{Diagnostic assessment of Infinium I/II probe-type bias. 
    (\textbf{Left}) Density of $\beta$-values by probe design shows well-overlapping distributions. 
    (\textbf{Right}) Q--Q plot (Type~II vs.~Type~I) with median deviation $|\Delta| = 0.162$, confirming effective BMIQ normalization.}
    \label{fig:type_bias}
\end{figure}


\section{Technical Filtering}\label{sec:technical_filtering}

Technical filtering aims to remove unreliable or biologically confounded probes before normalization and statistical modeling.  
This step reduces noise, improves downstream reproducibility, and ensures that only high-confidence CpG loci are retained for analysis.

\paragraph{Exclusion of technical probe sets.}
I excluded probes using curated resources that operationalise known technical artefacts (see Appendix~\ref{app:probe-filters} for details).
\begin{itemize}[label=-]
  \item \textbf{SNP-affected probes:} probes with common variation at the interrogated CpG, at the single-base extension site, or within the probe body \cite{zhou2016,pidsley2016}.
  \item \textbf{Cross-reactive probes:} probes with off-target/multi-mapping hybridisation \cite{chen2013}, \cite{mccartney2016}, \cite{zhou2016}.
  \item \textbf{Design-/platform-specific masks:} consolidated \texttt{MASK\_*} flags for mapping, SNP windows, non-CpG probes, and optional sex-chromosome probes \cite{zhou2016}.
  \item \textbf{Naeem hierarchical QC (450K):} discard logic for multi-mapping, repeats, INDEL, and disruptive SNPs \cite{naeem2014}.
\end{itemize}
\textbf{List provenance used here.}
Naeem et al.~2014~\cite{naeem2014}; Chen et al.~2013~\cite{chen2013}; Pidsley et al.~2016~\cite{pidsley2016}; Zhou et al.~2016~\cite{zhou2016}; McCartney et al.~2016~\cite{mccartney2016}. \good{Total CpGs removed: 225,426.}

\paragraph{Annotation-based filtering.}
I performed a cross-check with the official Illumina manifest file 
(\href{https://emea.support.illumina.com/array/array_kits/infinium_humanmethylation450_beadchip_kit/downloads.html?utm_source=chatgpt.com/}{\textit{HumanMethylation450 v1.2 Manifest File}}) to ensure that only valid and well-characterized loci were retained.  
This annotation-based filtering step validates probe integrity using the manufacturer's reference genome mapping (hg19) and removes:
\begin{itemize}[label=-]
  \item Probes with invalid or missing chromosome information (\texttt{CHR});
  \item Probes with undefined or non-positive genomic positions (\texttt{MAPINFO});
  \item Duplicated probe identifiers (\texttt{IlmnID});
  \item Non-CpG-targeting probes (i.e., IDs beginning with ``ch'').
\end{itemize}

This step guarantees consistency between the experimental dataset and the official Illumina annotation, harmonizing CpG identifiers across datasets and preventing misaligned genomic coordinates in downstream analyses.  
The remaining probes thus represent a validated subset of the HumanMethylation450 array.

\good{After manifest-based validation, \textbf{875 non-CpG probes} were removed, leaving a final matrix of \textbf{407 samples $\times$ 259,213 CpGs}.}
{\color{red}DA AGGIUNGERE LA REFERENCE}

\section{Filtering of Invariant CpGs}\label{sec:invariant_filtering}

CpG sites exhibiting minimal methylation variability across samples provide no discriminatory information and may inflate the multiple-testing burden.  
Following the empirically driven approach of Edgar \textit{et al.}~\cite{Edgar2017}, probes with low dispersion were identified using the inter-decile \textbf{beta-range}:
$r_{\beta} = \mathrm{P90}(\beta) - \mathrm{P10}(\beta)$,
which quantifies methylation variability in a robust and outlier-resistant manner.

\paragraph{Whole-cohort variability analysis.}
Across all tissue types, the $r_{\beta}$ distribution was highly right-skewed, with most loci showing limited variability (Figure~\ref{fig:beta_range_compare}, left).  
Three candidate thresholds ($r_{\beta} < 0.01$, $0.02$, $0.05$) were evaluated, corresponding to:
\good{$r_{\beta} <$ 0.01: 1,782\text{ CpGs removed}},
\good{$r_{\beta} <$ 0.02: 28,569}, 
\good{$r_{\beta} <$ 0.05: 79,433}.

{\color{red}
The conservative cutoff $r_{\beta}\ge0.01$ was selected, removing only invariant probes while retaining loci with meaningful biological variation. -- MANCA DA DECIDERE
}

\paragraph{Normal and adjacent-tissue subset.}
To investigate whether tumor-related heterogeneity influenced the variability profile, the same analysis was repeated using only normal and normal-adjacent tissues (labels~0,~1,~3).  
As expected, the overall dispersion decreased (Figure~\ref{fig:beta_range_compare}, right), yielding:
\good{$r_{\beta} <$ 0.01: 3,972\text{ CpGs removed}}, 
\good{$r_{\beta} <$ 0.02: 40,342}, 
\good{$r_{\beta} <$ 0.05: 102,473}.

This confirms that tumor samples contribute most of the global variability, while non-neoplastic tissues exhibit tighter methylation clustering.

\begin{figure}[H]
    \centering
    \begin{subfigure}[t]{0.48\textwidth}
        \includegraphics[width=\textwidth]{Figures/beta_range_distribution_study.png}
        \caption{All samples (Normal, Adjacent, Tumor).}
    \end{subfigure}
    \hfill
    \begin{subfigure}[t]{0.48\textwidth}
        \includegraphics[width=\textwidth]{Figures/beta_range_distribution_study_normal_adjacent.png}
        \caption{Subset restricted to Normal and Adjacent tissues.}
    \end{subfigure}
    \caption{Distribution of beta-range ($\mathrm{P90}-\mathrm{P10}$) across CpGs with candidate thresholds (0.01, 0.02, 0.05).  
    The right panel shows reduced variability when excluding tumor samples, consistent with tissue-specific stability reported by Edgar \textit{et al.}~\cite{Edgar2017}.}
    \label{fig:beta_range_compare}
\end{figure}

{\color{red}Final dataset retained CpGs with $r_{\beta}\ge0.01$, following the tissue-specific non-variability filtering approach of Edgar \textit{et al.}, ensuring the removal of non-informative loci while preserving biologically relevant variation. -- MANCA DA DECIDERE}


\section{Comparison of Beta-value and M-value Quantifications}\label{sec:beta_mvalue_comparison}

Illumina Infinium arrays measure two fluorescence intensities per CpG: methylated ($y^{(M)}$) and unmethylated ($y^{(U)}$) signals, both background-corrected and normalized.  
From these signals, two equivalent representations of methylation level can be derived~\cite{Du2010}.

\paragraph{Definitions.}
The \textbf{Beta-value} ($\beta$) represents the proportion of methylated signal:
\[
\beta_i = \frac{\max(y_i^{(M)},0)}{\max(y_i^{(M)},0) + \max(y_i^{(U)},0) + \alpha},
\quad 0 \le \beta_i \le 1,
\]
while the \textbf{M-value} ($M$) is defined as the log$_2$-ratio of methylated to unmethylated intensities:
\[
M_i = \log_2\left(\frac{\max(y_i^{(M)},0)+\alpha}{\max(y_i^{(U)},0)+\alpha}\right),
\quad M_i \in (-\infty,\infty).
\]
The two measures are related by the logit transform:
\[
M_i = \log_2\!\left(\frac{\beta_i}{1-\beta_i}\right)
\quad\Longleftrightarrow\quad
\beta_i = \frac{2^{M_i}}{1 + 2^{M_i}}.
\]

\paragraph{Rationale.}
As established by Du \textit{et al.}~\cite{Du2010}, $\beta$-values are bounded and heteroscedastic—variance depends on the mean, especially near 0 or 1—whereas $M$-values are approximately homoscedastic and symmetrically distributed, making them statistically more suitable for linear-model and $t$-test analyses.  
For interpretability, $\beta$ remains preferred for reporting because it directly corresponds to a percentage of methylation.

\paragraph{Implementation in this dataset.}
The \textbf{GSE69914} matrix provides $\beta$-values only; raw intensities ($y^{(M)}, y^{(U)}$) are unavailable.  
Hence, I derived $M$ using the standard logit transform:
\[
M = \log_2\!\left(\frac{\beta + \varepsilon}{1 - \beta + \varepsilon}\right),
\]
with a small $\varepsilon$ for numerical stability.  
This reproduces the expected scale and statistical properties of $M$, enabling robust modeling even without raw intensity data.

\good{All subsequent statistical analyses are performed in $M$-space (for inference and testing), and results are converted back to $\beta$ for visualization and biological interpretation.}


\section{Batch-Effect Correction} 
Remove inter-array technical variation using \textbf{ComBat} 
(\href{https://academic.oup.com/biostatistics/article/8/1/118/252073}{Johnson et al., 2007}) 
or its methylation-specific extension \textbf{ComBat-met} 
(\href{https://pubmed.ncbi.nlm.nih.gov/40391088/}{Wang et al., 2025}). \\
If batch effects are confounded with biological groups, 
include the batch variable as a covariate in linear modeling (e.g., \textit{limma}).

\section{Preliminary Statistical Filters} 
\textbf{Levene / Brown–Forsythe test:} assesses homogeneity of variances across groups. \\
\textbf{DiffVar:} empirical Bayes model for differential variance detection 
(\href{https://genomebiology.biomedcentral.com/articles/10.1186/s13059-014-0465-4}{Phipson et al., 2014}). \\
\textbf{limma:} moderated linear model for differential methylation, 
suitable for M-values and inclusion of covariates 
(\href{https://academic.oup.com/nar/article/43/7/e47/2414268}{Ritchie et al., 2015}). \\
\textbf{iEVORA:} extension of EVORA for identifying CpGs with increased epigenetic instability 
in pre-neoplastic or field-defect tissues 
(\href{https://academic.oup.com/bioinformatics/article/28/11/1487/22492641}{Teschendorff et al., 2012}).

\section{Correlation Pruning} 
Remove redundant CpGs with high inter-correlation 
(e.g., Pearson $|r| > 0.9$) within local genomic regions to reduce collinearity 
(\href{https://academic.oup.com/bioinformatics/article/36/10/3239/5775229}{Gatev et al., 2020}; 
    \href{https://academic.oup.com/bib/article/23/1/bbab395/6420930}{Bommert et al., 2022}).

\section{Feature Standardization for Machine Learning} 
Standardize features (e.g., z-score transformation or 
\href{https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html}{StandardScaler}) 
on M-values to ensure comparable scales across CpGs. 
Fit the scaler on the training fold and apply it to the test fold to prevent data leakage. 
(\href{https://academic.oup.com/jss/article/33/1/1/3703127}{Friedman et al., 2010}; 
    \href{https://pmc.ncbi.nlm.nih.gov/articles/PMC10863277/}{Aref-Eshghi et al., 2025}).


\clearpage

\appendix
\section{Filtering lists}
\label{app:probe-filters}

This appendix details the major technical filtering lists and annotations applied in Illumina 450K and EPIC methylation arrays to remove unreliable or ambiguous CpG probes. 

\begin{table}[H]
\small
\caption{Technical categories covered by each filtering resource.}
\centerline{ % <-- USA QUESTO
\begin{tabular}{lccccc}
\toprule
\textbf{Category} & \textbf{Naeem} \ref{app:naeem2014} & \textbf{Chen} \ref{app:chen2013} & \textbf{Pidsley} \ref{app:pidsley2016} & \textbf{Zhou} \ref{app:zhou2016} & \textbf{McCartney} \ref{app:mccartney2016}\\
\midrule
Cross-hybridisation / multi-mapping & Yes (Steps 1–2) & Yes & Yes & \texttt{MASK\_mapping} & Table~2+3 \\
SNP at CpG / extension base   	& Yes (Step 5) & -- & Yes & \texttt{MASK\_snp5, MASK\_extBase} & -- \\
Nearby SNP tolerated   	& Conditional (Step 6) & -- & -- & -- & -- \\
INDEL / structural variant   	& Yes (Step 3) & -- & -- & -- & -- \\
Non-CpG probes   	& -- & -- & Yes 	& \texttt{MASK\_nonCG} & Table~3 \\

\bottomrule
\end{tabular}
} 
\end{table}

\subsection{Reducing the risk of false discovery enabling identification of biologically significant genome-wide methylation status using the humanmethylation450 array}
\label{app:naeem2014}
\begin{wrapfigure}{r}{0.29\textwidth} % {r}=destra, {0.4\textwidth}=larghezza
    \centering
    \includegraphics[width=\linewidth]{Figures/Workflow for determining affected Probes.jpg} % o .png, .pdf, .eps...
    \caption{Workflow for determining affected Probes.}
    \label{fig:Workflow}
\end{wrapfigure}
Naeem \emph{et al.} \cite{naeem2014} proposed a structured filtering framework to reduce false discoveries by sequentially discarding probes based on hybridisation specificity and genomic integrity (Figure \ref{fig:Workflow}).  
The main exclusion steps are:
\begin{enumerate}[label=-]
  \item Multi-mapping or cross-hybridising probes $\Rightarrow$ \textit{discard}.
  \item Probes overlapping repetitive elements (LINE/SINE/ALU) $\Rightarrow$ \textit{discard}.
  \item Probes targeting regions with INDELs $\Rightarrow$ \textit{discard}.
  \item Probes overlapping SNPs:
    \begin{enumerate}[label=--]
      \item SNP at CpG or extension site $\Rightarrow$ \textit{discard}.
      \item SNP near target but not interfering in bisulfite space $\Rightarrow$ \textit{keep}.
    \end{enumerate}
\end{enumerate}
The resulting ``discard'' set therefore removes probes affected by cross-reactivity, structural polymorphisms (INDELs), and SNPs that alter CpG interrogation.

\subsection{Discovery of cross-reactive probes and polymorphic cpgs in the illumina infinium humanmethylation450 microarray}
\label{app:chen2013}
Chen \emph{et al.} \cite{chen2013} empirically identified probes in the 450K array that exhibit off-target hybridisation or overlap with common SNPs.  
For this project, only the \textbf{cross-reactive list} is available and used.  
This list enumerates $\sim$29k multi-mapping probes whose methylation signal cannot be uniquely attributed to one genomic locus.

\subsection{Critical evaluation of the Illumina MethylationEPIC BeadChip microarray for whole-genome DNA methylation profiling}
\label{app:pidsley2016}
Pidsley \emph{et al.} \cite{pidsley2016} provide a platform-level assessment of the EPIC array, with explicit \emph{annotated probe lists} that flag probes whose methylation signal may be confounded by design- or genome-related artefacts. The focus is on probe categories and positions where technical bias arises, rather than on a universal, prescriptive blacklist. In particular, they catalogue:

\begin{itemize}[label=-]
  \item \textbf{Cross-hybridising CpG-targeting probes:} CpG probes showing sequence homology (off-target matches) to additional genomic loci, yielding non-unique hybridisation and potentially inflated or ambiguous $\beta$ signals.
  \item \textbf{Cross-hybridising non-CpG-targeting probes:} off-target issues among CNG/non-CpG probes; these are typically excluded in CpG-centric analyses due to limited interpretability and higher risk of artefacts.
  \item \textbf{Probes overlapping common genetic variation:} annotation of variants from population data at three critical positions:
  \begin{enumerate}[label=--]
    \item \textit{At the interrogated CpG} (polymorphic CpG) --- directly affects the presence of the CpG dinucleotide and the measured methylation state;
    \item \textit{At the single-base extension (SBE) site} (Type~I) --- perturbs extension and dye chemistry, biasing intensity ratios;
    \item \textit{Within the probe body} --- can reduce binding affinity or alter hybridisation kinetics, especially for common variants.
  \end{enumerate}
\end{itemize}


\subsection{Comprehensive characterization, annotation and innovative use of infinium dna methylation beadchip probes}
\label{app:zhou2016}
Zhou \emph{et al.} \cite{zhou2016} released a unified probe annotation for both 450K and EPIC arrays with multiple binary mask columns (\texttt{MASK\_*}).  
Each \href{https://zwdzwd.github.io/InfiniumAnnotation/mask.html}{mask} flags probes to be removed due to specific technical artifacts.
\begin{itemize}[label=-]
  \item \texttt{MASK.mapping}: probes with low or inconsistent mapping quality (non-unique alignment or presence of INDELs);
  \item \texttt{MASK.typeINextBaseSwitch}: Type-I probes carrying a SNP in the extension base that causes a color-channel switch (\emph{CCS} probes);
  \item \texttt{MASK.extBase}: probes whose extension base is inconsistent with the expected color channel or CpG context;
  \item \texttt{MASK.sub30.copy}: probes with non-unique 30-bp 3' subsequences (potential cross-hybridisation);
  \item \texttt{MASK.snp5.common}: probes overlapping a SNP within $\pm5$\,bp of the interrogated CpG (even with global MAF < 1\%);
  \item \texttt{MASK.snp5.GMAF1p}: probes overlapping SNPs with global MAF > 1\%;
  \item \texttt{MASK.general}: recommended composite mask integrating mapping, SNP, and cross-reactivity filters for general use;
  \item \texttt{MASK.rmsk15}: probes overlapping RepeatMasker regions (not recommended for exclusion in standard workflows).
\end{itemize}

This resource provides a programmatic and reproducible way to perform fine-grained probe masking.

\subsection{Identification of polymorphic and off-target probe binding sites on the Illumina Infinium MethylationEPIC BeadChip}
\label{app:mccartney2016}
McCartney \emph{et al.} \cite{mccartney2016} assessed probe design artifacts and published supplementary tables that include:
\begin{itemize}[label=-]
  \item Cross-hybridising CpG-targeting probes;
  \item Cross-hybridising non-CpG-targeting probes.
\end{itemize}



\printbibliography
\end{document}
